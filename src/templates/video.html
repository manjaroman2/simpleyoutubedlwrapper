<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ endpoint }}</title>
</head>

<body>
    <style>
        * {
            font-size: large;
            font-family: "Lucida Console", "Courier New", monospace;
            font-family: sans-serif;
            margin: 0;
        }

        div#vbar {
            width: 100%;
            display: -webkit-flex;
            padding: 3px;
        }

        div#vbar>* {
            padding-left: 10vw;
        }

        form {
            width: 100%;
            display: -webkit-flex;
            padding: 10px;
        }

        input#link {
            flex: auto;
            -webkit-flex: 2;
        }

        input#zip {
            margin-right: 1vw;

        }

        form>p {
            margin-right: 4vw;
        }

        form>select {
            margin-left: 2vw;
            margin-right: 2vw;
        }

        table,
        table * a {
            padding: 10px;
        }

        td>* {
            font-size: medium;
        }

        td {
            padding-left: 20px;
        }
    </style>
    <div id="vbar">
        <a href="https://github.com/manjaroman2/simpleyoutubedlwrapper.git">this project is on github</a>
        {% for ep in links %}
        <a href="{{ep}}">{{ep}}</a>
        {% endfor %}
    </div>
    <div>
        <form action="{{form_action}}" method="post">
            <input type="text" name="link" id="link"
                placeholder="Your link to a yt video, yt playlist, tweet,...(https://www.youtube.com/watch?v=dQw4w9WgXcQ)">
            <select name="codec" id="codec">
                {% for c in codecs %}
                <option value="{{c}}">{{ c }}</option>
                {% endfor %}
            </select>
            <input type="checkbox" name="zip" id="zip" value="true">
            <p>zip</p>
        </form>
    </div>
    <table>
        {% for worker in workers %}
        {% if worker.is_running %}

        <tr>
            <td>
                <p> {{ worker.time | ctime }} </p>
            </td>
            <td>
                <a href="{{worker.href}}">{{ worker.name }}</a>
            </td>
        </tr>
        {% endif %}
        {% endfor %}
        {% if progress is not none and fileprogress is not none %}
        <tr>
            <td>
                <p id="{{fileprogress}}">{{ fileprogress }}</p>
            </td>
            <td>
                <p id="{{progress}}">{{ progress }}%</p>
            </td>

        </tr>
        {% endif %}
        {% for z in zs %}
        <tr>
            <td>
                <p> {{ z.time | ctime }} </p>
            </td>
            <td>
                <a href="{{z.href}}">{{ z.name }}</a>
            </td>
        </tr>
        {% endfor %}
    </table>
    <script>
        window.onload = () => {
            setInterval(() => {
                updateProgress();
            }, 3000);
        }
        function updateProgress() {
            console.log("updateProgress");
            const xhr = new XMLHttpRequest();
            xhr.open("GET", "/s/api/progress");
            xhr.send();
            xhr.onload = () => {
                const data = JSON.parse(xhr.responseText);
                console.log(data);
                if (data["playlist_count"] === undefined) {
                    return;
                }
                const progress = document.querySelector("p#progress");
                const fileprogress = document.querySelector("p#fileprogress");
                if (data.progress !== undefined) {
                    progress.innerText = data.progress + "%";
                }
                if (data.fileprogress !== undefined) {
                    fileprogress.innerText = data.fileprogress;
                }
            }
        }


    </script>
</body>

</html>